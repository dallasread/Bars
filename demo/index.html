<!DOCTYPE html>
<html>
    <head>
        <title></title>
    </head>
    <body>
        <script type="text/template"></script>
        <script src="bars.js"></script>
        <script type="text/javascript">
            function test(testName, func, expects) {
                document.body.innerText = '';

                func();

                if (document.body.innerHTML === expects) {
                    console.debug('TEST: ' + testName, 'PASS');
                } else {
                    console.error('TEST: ' + testName, 'FAIL', '-', 'Actual: "' + document.body.innerHTML + '"', 'Expected: "' + expects + '"');
                }
            }
        </script>
        <script type="text/javascript">
            var bars = window.Bars.create();

            test('Partial Variables', function() {
                bars.registerPartial('partialVariables', 'My name is {{a/first}}{{a/last}}.');
                var template = '{{>partialVariables a=me/name}}';
                window.b = bars.compile(template);
                window.c = window.b.render();
                window.c.appendTo(document.body);
                window.c.update({ me: { name: { first: 'D', last: 'R' } } });
            }, 'My name is DR.');

            test('Empty Undefined', function() {
                var template = '{{a}} : {{b}} : {{c}} : {{d}} : {{e/f}}';
                window.b = bars.compile(template);
                window.c = window.b.render();
                window.c.appendTo(document.body);
                window.c.update({ a: undefined, b: null, c: void(0), d: 0 });
            }, ' :  :  : 0 : ');

            test('Loops In Loops', function() {
                var template = '{{#each a}}{{#each b}}{{.}}{{/each}}{{/each}}';
                window.b = bars.compile(template);
                window.c = window.b.render();
                window.c.appendTo(document.body);
                window.c.update({ a: { 0: { b: { 0: 'a', 1: 'b', 2: 'c' } }, 1: { b: { 0: 'a', 1: 'b', 2: 'c' } }, 2: { b: { 0: 'a', 1: 'b', 2: 'c' } }, 3: { b: { 0: 'a', 1: 'b', 2: 'c' } } } });
            }, 'abcabcabcabc');

            test('HTML Escape', function() {
                var template = '{{{a}}}';
                window.b = bars.compile(template);
                window.c = window.b.render();
                window.c.appendTo(document.body);
                window.c.update({ a: '<h1>This is an H1 tag!</h1>' });
            }, '<div><h1>This is an H1 tag!</h1></div>');

            test('Array Update', function() {
                var cats = [{ name: 'A' }, { name: 'B' }, { name: 'C' }, { name: 'D' }],
                    template = '<ul>{{#each cats}}<li>{{name}}</li>{{/each}}</ul>',
                    data = { cats: cats };

                window.b = bars.compile(template);
                window.c = window.b.render();
                window.c.appendTo(document.body);
                window.c.update(data);

                delete cats[1];
                delete cats[3];

                window.c.update(data);
            }, '<ul><li>A</li><li>C</li></ul>');

            // In loop, use variable in partial
            // Remove partials if part of loop

            test('Partial Variables', function() {
                var template = '{{#each people}}{{>partialVariables fullName=name initial=name/initial}}{{/each}}',
                    people = [{ name: { first: 'O', initial: 'D', last: 'R' } }];

                bars.registerPartial('partialVariables', 'My name is {{fullName/first}}{{initial}}{{fullName/last}}.');

                window.b = bars.compile(template);
                window.c = window.b.render();
                window.c.appendTo(document.body);
                window.c.update({ people: [1] });
                window.c.update({ people: people });
            }, 'My name is ODR.');

            // BLARGH...
            // bars.registerHelper('helper', function(a) {
            //     return 'HELPER';
            // });

            // bars.registerPartial('partial', 'PARTIAL');

            // bars.registerBlock('block', function (a) {
            //     return 'BLOCK';
            // });
            // var template = 'BEFORE :: \
            //     <input value="{{name}}" onkeyup="javascript:a.name=this.value;window.c.update(a);">\
            //     <span class="{{name}} {{name}}">{{#if name}}\
            //     NAME={{name}}\
            //     (helper: {{?helper name name}})\
            // {{else}}\
            //     noname\
            // {{/if}}</span> :: ({{>partial}})';
            // window.a = {name:'My Name'};
            // window.b = bars.compile(template);
            // window.c = window.b.render();
            // window.c.appendTo(document.body);
            // window.c.update(window.a);
            // setInterval(function() {
            //     var n = Math.random();
            //     window.c.update({
            //         name: n < 0.8 ? n : null
            //     });
            // }, 1000);
        </script>
    </body>
</html>
